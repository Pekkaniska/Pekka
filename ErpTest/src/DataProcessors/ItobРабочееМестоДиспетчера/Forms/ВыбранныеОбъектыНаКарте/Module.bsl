
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ИдентификаторСтроки = Неопределено;
	Параметры.Свойство("ИдентификаторСтроки", ИдентификаторСтроки);
	Если ТипЗнч(ИдентификаторСтроки) = Тип("Строка") Тогда
	    Отказ = Отказ ИЛИ НЕ ЗаполнитьТаблицуЗначенийСтрокой(ИдентификаторСтроки);
	Иначе
		Отказ = Истина;
	КонецЕсли; 
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЗакрытьФорму(Команда)
	Закрыть();
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Функция ЗаполнитьТаблицуЗначенийСтрокой(ИдентификаторСтроки)
	ИдентификаторСтроки = СтрЗаменить(ИдентификаторСтроки,",",Символы.ПС);
	Если ПустаяСтрока(ИдентификаторСтроки) Тогда
		Возврат Ложь;
	КонецЕсли; 
	МассивСтрок = Новый Массив;
	Для Счетчик = 1 По СтрЧислоСтрок(ИдентификаторСтроки) Цикл
		КодТерминала = СтрПолучитьСтроку(ИдентификаторСтроки, Счетчик);
	    МассивСтрок.Добавить(Число(КодТерминала));
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ItobПривязкиТерминаловСрезПоследних.Объект КАК ОбъектМониторинга,
		|	ItobПривязкиТерминаловСрезПоследних.Терминал КАК Терминал
		|ИЗ
		|	РегистрСведений.ItobПривязкиТерминалов.СрезПоследних КАК ItobПривязкиТерминаловСрезПоследних
		|ГДЕ
		|	ItobПривязкиТерминаловСрезПоследних.Терминал.Код В(&МассивКодов)
		|	И ItobПривязкиТерминаловСрезПоследних.ТерминалУстановлен = ИСТИНА";
	Запрос.УстановитьПараметр("МассивКодов", МассивСтрок);
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ЗаполнитьЗначенияСвойств(ОбъектыМониторинга.Добавить(), Выборка);
	КонецЦикла;
	Количество = Выборка.Количество();
	Возврат Истина;
КонецФункции // ЗаполнитьТаблицуЗначенийСтрокой()

#КонецОбласти
 