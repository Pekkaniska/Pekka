
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда // Возврат при получении формы для анализа.
		АвтоТест = Истина;
		Возврат;
	КонецЕсли;
	
	Если Не Параметры.Свойство("ПрограммноеОткрытие") Тогда 
		флОбновлениеНеТребуется = ОбновлениеУАТНеТребуется();
	КонецЕсли;
	
	УстановитьНомераВерсий(ТекущаяВерсияУАТ, НоваяВерсияУАТ);
	
	Если РольДоступна("АдминистраторСистемы") 
		И (РольДоступна("уатАдминистрированиеУАТ") Или РольДоступна("ПолныеПрава")) Тогда 
			Если флОбновлениеНеТребуется Тогда 
				Элементы.НаборПрав.ТекущаяСтраница = Элементы.ОбновлениеНеТребуется;
			Иначе 
				Элементы.НаборПрав.ТекущаяСтраница = Элементы.ЕстьПравоАдминистрирования;
			КонецЕсли;
	Иначе 
		Элементы.НаборПрав.ТекущаяСтраница = Элементы.НетПраваАдминистрирования;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если АвтоТест Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытииЗавершение(ДополнительныеПараметры) Экспорт
    
    

КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ПерезапуститьИОбновиться(Команда)
	
	//ДопПараметрыЗапуска = "/C ""ЗапуститьОбновлениеИнформационнойБазы""";
	//ЗавершитьРаботуСистемы(Ложь, Истина, ДопПараметрыЗапуска);
	
	ОткрытьФорму("Обработка.ОбновлениеВерсииИБ.Форма");
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервереБезКонтекста
Функция ОбновлениеУАТНеТребуется()
	
	Возврат Не уатОбновлениеИнформационнойБазы.НеобходимоОбновлениеИнформационнойБазыУАТ();
	
КонецФункции // ОбновлениеУАТНеТребуется()

&НаСервереБезКонтекста
Процедура УстановитьНомераВерсий(ВерсияИБ, ВерсияКонфигурации)
	
	// структура описания подсистемы УАТ
	ОписаниеУАТ = Новый Структура("Имя, Версия, ТребуемыеПодсистемы", "", "", Новый Массив);
	
	// заполение данных по подсистеме УАТ
	уатОбновлениеИнформационнойБазы.ПриДобавленииПодсистемы(ОписаниеУАТ);
	
	ВерсияКонфигурации = ОписаниеУАТ.Версия;
	ВерсияИБ = ОбновлениеИнформационнойБазыСлужебный.ВерсияИБ(ОписаниеУАТ.Имя);
	
КонецПроцедуры


#КонецОбласти