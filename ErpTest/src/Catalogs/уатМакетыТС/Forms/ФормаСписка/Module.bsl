
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	//уатЗащищенныеФункцииСервер.уатСправочникФормаСпискаПриСозданииНаСервере(Отказ, СтандартнаяОбработка, ДопПараметрыОткрытие);
	Если Отказ тогда
		Возврат;
	КонецЕсли;
	
	// УправлениеПредприятием.СлужебныеПодсистемы
	СобытияФорм.ПриСозданииНаСервере(ЭтаФорма, Отказ, СтандартнаяОбработка);
	// Конец УправлениеПредприятием.СлужебныеПодсистемы
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	Если ИмяСобытия = "Изменен макет ТС" Тогда
		СписокПриАктивизацииСтроки(Неопределено);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	//уатЗащищенныеФункцииКлиент.уатСправочникФормаСпискаПриОткрытии(Отказ, ДопПараметрыОткрытие);
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовТаблицыФормы_Список

&НаКлиенте
Процедура СписокПриАктивизацииСтроки(Элемент)
	Если НЕ ОтрисовываетсяМакет Тогда
		ТекСтрока = Элементы.Список.ТекущиеДанные;
		Если ТекСтрока = Неопределено ИЛИ ТекСтрока.ЭтоГруппа Тогда
			Возврат;
		КонецЕсли;
		
		МакетТС = ТекСтрока.Ссылка;
		ЗагрузитьМакетТС(МакетТС);
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

// УправлениеПредприятием.СлужебныеПодсистемы
&НаКлиенте
Процедура Подключаемый_ВыполнитьПереопределяемуюКоманду(Команда)
	СобытияФормКлиент.ВыполнитьПереопределяемуюКоманду(ЭтаФорма, Команда);
КонецПроцедуры
// Конец УправлениеПредприятием.СлужебныеПодсистемы

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ОтрисоватьШину(СтрокаШины, МакетВывода)
	ОтрисовываетсяМакет = Истина;
	
	НоваяКартинка = МакетВывода.Рисунки.Добавить(ТипРисункаТабличногоДокумента.Картинка);
	НоваяКартинка.Лево = СтрокаШины.Строки.Найти("Кордината X").Значение;
	НоваяКартинка.Верх = СтрокаШины.Строки.Найти("Кордината Y").Значение;
	НоваяКартинка.Ширина = СтрокаШины.Строки.Найти("Ширина").Значение;
	НоваяКартинка.Высота = СтрокаШины.Строки.Найти("Высота").Значение;
	НоваяКартинка.РазмерКартинки = РазмерКартинки.Пропорционально;
	НоваяКартинка.ЦветЛинии = ЦветаСтиля.ЦветРамки;
	НоваяКартинка.Линия = Новый Линия(ТипЛинииРисункаТабличногоДокумента.Сплошная, 2);
	НоваяКартинка.ЦветФона = ЦветаСтиля.ЦветФонаФормы;
	
	ОтрисовываетсяМакет = Ложь;
КонецПроцедуры

&НаСервере
Процедура ОтрисоватьКорпус(СтрокаКорпус, Макет, МакетВывода)
	ОтрисовываетсяМакет = Истина;
	
	НоваяКартинка = МакетВывода.Рисунки.Добавить(ТипРисункаТабличногоДокумента.Картинка);
	НоваяКартинка.Лево = СтрокаКорпус.Строки.Найти("Кордината X").Значение;
	НоваяКартинка.Верх = СтрокаКорпус.Строки.Найти("Кордината Y").Значение;
	НоваяКартинка.Ширина = СтрокаКорпус.Строки.Найти("Ширина").Значение;
	НоваяКартинка.Высота = СтрокаКорпус.Строки.Найти("Высота").Значение;
	НоваяКартинка.РазмерКартинки = РазмерКартинки.Пропорционально;
	НоваяКартинка.ГраницаСлева = Ложь;
	НоваяКартинка.ГраницаСправа = Ложь;
	НоваяКартинка.ГраницаСверху = Ложь;
	НоваяКартинка.ГраницаСнизу = Ложь;
	
	Если Макет.ХранитьМакетВоВнешнемФайле Тогда
		Попытка
			ПолноеИмяФайла = СтрокаКорпус.Строки.Найти("Путь").Значение;
			ФайлНаДиске = Новый Файл(ПолноеИмяФайла);
			Если ФайлНаДиске.Существует() Тогда
				НоваяКартинка.Картинка = Новый Картинка(ПолноеИмяФайла);   			  
			КонецЕсли;
		Исключение
			Сообщить("Ошибка открытия файла картинки: " + ИнформацияОбОшибке().Описание + " по причине " + ИнформацияОбОшибке().Причина, СтатусСообщения.Внимание)
		КонецПопытки;
	Иначе
		Попытка
			НоваяКартинка.Картинка = Макет.ХранилищеМакета.Получить();
		Исключение
			Сообщить("Ошибка отображения картинки: " + ИнформацияОбОшибке().Описание + " по причине " + ИнформацияОбОшибке().Причина, СтатусСообщения.Внимание)
		КонецПопытки;
	КонецЕсли;
	
	ОтрисовываетсяМакет = Ложь;
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьМакетТС(МакетТС)
	ДопМакет = Справочники.уатМакетыТС.ПолучитьМакет("Макет");
	
	Если НЕ уатОбщегоНазначения.уатЗначениеНеЗаполнено(МакетТС.Ссылка) Тогда
		КешНастройкаРисункаТС = МакетТС.ДеревоМакета.Получить();
		Если КешНастройкаРисункаТС =  Неопределено Тогда
			Возврат; 
		КонецЕсли;
		
		Корпус = КешНастройкаРисункаТС.Строки.Найти("КорпусАвто");
		ОтрисоватьКорпус(Корпус, МакетТС, ДопМакет);
		
		КШины  = КешНастройкаРисункаТС.Строки.Найти("Шины");
		Для Каждого Шина Из КШины.Строки Цикл
			Если Шина.Строки.Найти("Установлено").Значение Тогда
				ОтрисоватьШину(Шина, ДопМакет);
			КонецЕсли;
		КонецЦикла; 
	Иначе
	КонецЕсли;
	
	ТабДок = ДопМакет;
КонецПроцедуры

#КонецОбласти
